<!DOCTYPE html>
<html>
<head>
    <title>Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary px-4">
        <a class="navbar-brand" href="#">Voucher Bot Admin</a>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Logout</a>
    </nav>

    <div class="container mt-4">
        <!-- Stats -->
        <div class="row mb-4 text-center">
            <div class="col"><div class="card p-2"><h5>Total</h5><h3>{{ stats.total }}</h3></div></div>
            <div class="col"><div class="card p-2 text-success"><h5>Active</h5><h3>{{ stats.active }}</h3></div></div>
            <div class="col"><div class="card p-2 text-danger"><h5>Used/Paused</h5><h3>{{ stats.paused }}</h3></div></div>
            <div class="col"><div class="card p-2 text-primary"><h5>Users</h5><h3>{{ stats.redeemed }}</h3></div></div>
        </div>

        <div class="row">
            <!-- Create Form -->
            <div class="col-md-4">
                <div class="card p-3 mb-3">
                    <h5 class="mb-3">Create Code</h5>
                    <form action="{{ url_for('create_voucher') }}" method="POST">
                        
                        <label class="fw-bold text-primary">Custom Code (Optional)</label>
                        <input type="text" name="custom_code" class="form-control mb-2 border-primary" placeholder="Example: 1702297">
                        <small class="text-muted d-block mb-3">Leave empty for random code.</small>

                        <label>Validity (Minutes)</label>
                        <input type="number" name="minutes" class="form-control mb-2" value="60" required>
                        
                        <label>Max Usage Limit</label>
                        <input type="number" name="max_use" class="form-control mb-3" value="1" required>
                        
                        <button class="btn btn-success w-100">Generate</button>
                    </form>
                </div>

                <div class="card p-3">
                    <h5>Settings</h5>
                    <form action="{{ url_for('set_channel') }}" method="POST">
                        <label>Required Channel</label>
                        <input type="text" name="chat_id" class="form-control mb-2" value="{{ channel if channel else '' }}" placeholder="@channel_username">
                        <button class="btn btn-secondary w-100">Save</button>
                    </form>
                </div>
            </div>

            <!-- List -->
            <div class="col-md-8">
                <div class="card p-3">
                    <h5>Active Codes</h5>
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}<div class="alert alert-info py-1">{{ messages[0] }}</div>{% endif %}
                    {% endwith %}
                    <div class="table-responsive">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Used</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for v in vouchers %}
                                <tr>
                                    <td class="fw-bold font-monospace text-primary">{{ v.code }}</td>
                                    <td>{{ v.used_count }} / {{ v.max_use }}</td>
                                    <td>
                                        {% if v.paused %} <span class="badge bg-warning">Paused</span>
                                        {% elif v.used_count >= v.max_use %} <span class="badge bg-danger">Full</span>
                                        {% else %} <span class="badge bg-success">Active</span> {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('toggle_voucher', code=v.code) }}" class="btn btn-sm btn-outline-dark">P/R</a>
                                        <a href="{{ url_for('delete_voucher', code=v.code) }}" class="btn btn-sm btn-outline-danger">Del</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
